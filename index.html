<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TYI-2019</title>
    <link rel="stylesheet" href="./css/style.css">


    <script>



        function runMap() {
            // 50.255759, 35.158128
            // 49.392233, 36.236860
            // x1 y1 -> x2 y2
            // x3 y3 -> x4 y4

            var latlngs = null;
            function createRectangle(x1, y1, x4, y4) {
            	x2 = x4;
                y2 = y1;
                x3 = x1;
                y3 = y4;
                latlngs = [
                	[x1, y1],
                    [x2, y2],
                    [x4, y4],
                    [x3, y3],
                    [x1, y1],
                ];
            }

            var x1 = document.getElementById("upLeftCornerX").value;
            var y1 = document.getElementById("upLeftCornerY").value;
            x1 = parseFloat(x1);
            y1 = parseFloat(y1);

            var x3 = document.getElementById("downRightCirnerX").value;
            var y3 = document.getElementById("downRightCirnerY").value;
            x3 = parseFloat(x3);
            y3 = parseFloat(y3);

            createRectangle(x1, y1, x3, y3);

            // var latlngs = [
            //      [49.621593, 36.401131],
            //      [37.77, -122.43],
            //      [34.04, -118.2]
            // ];



            // It clears polylines
            for(i in map._layers) {
            	if(map._layers[i]._path != undefined) {
                	try {
                    	map.removeLayer(map._layers[i]);
                    }
                    catch(e) {
                    	console.log("problem with " + e + map._layers[i]);
                    }
                }
            }


            var polyline = L.polyline(latlngs, {color: 'red'}).addTo(map);
            // zoom the map to the polyline
            map.fitBounds(polyline.getBounds());
        }


        function Reset() {
			// It clears polylines
	        for(i in map._layers) {
	            if(map._layers[i]._path != undefined) {
	                try {
	                    map.removeLayer(map._layers[i]);
	                }
	                catch(e) {
	                  	console.log("problem with " + e + map._layers[i]);
	                }
	            }
	        }

	        document.getElementById('upLeftCornerX').value = "";
    		document.getElementById('upLeftCornerY').value = "";

    		document.getElementById('downRightCirnerX').value = "";
    		document.getElementById('downRightCirnerY').value = "";
		}
    </script>


</head>
<body>
    <div id="ever">
        <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
        <link href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" rel="stylesheet"/>
        <div id="mapid"></div>

        <form action="main.py" method="get" id="send">
            <input id="upLeftCornerX" name="upLeftCornerX" type="text" class="inp">
            <input id="upLeftCornerY" name="upLeftCornerY" type="text" class="inp">

            <input id="downRightCirnerX" name="downRightCirnerX" type="text" class="inp">
            <input id="downRightCirnerY" name="downRightCirnerY" type="text" class="inp">

            <input id="dronX" name="dronX" type="text" class="inp">
            <input id="dronY" name="dronY" type="text" class="inp">

            <!-- <input type="text" class="inp">
            <input type="text" class="inp"> -->

            <input id="submit" type="submit" value="submit">
            <input id="check" type="button" name="check" value="Check" onclick="runMap();">


            <input id="reset" type="button" name="reset" value="reset" onclick="Reset();">

        </form>

        <script>
            // Where you want to render the map.
            var element = document.getElementById('mapid');

            // Height has to be set. You can do this in CSS too.
            // element.style = 'height:100%;';

            // Create Leaflet map on map element.
            var map = L.map(element);

            // Add OSM tile leayer to the Leaflet map.
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Target GPS coordinates.
            var target = L.latLng('49.621593', '36.401131');

            // Set map center to target with zoom 14.
            map.setView(target, 8);


            


            var isUpDown = false; // false -> UpLeft;    true -> DownRight
            function onMapClick(e) {
            	var lat  = e.latlng.lat.toFixed(5);
    			var lon  = e.latlng.lng.toFixed(5);
    			console.log(lat);
    			console.log(lon);
    			console.log(isUpDown);
    			if (isUpDown == false) {
    				document.getElementById('upLeftCornerX').value = lat;
    				document.getElementById('upLeftCornerY').value = lon;
    			} else {
    				document.getElementById('downRightCirnerX').value = lat;
    				document.getElementById('downRightCirnerY').value = lon;
    			}
    			isUpDown = !isUpDown;
    			runMap();
            }

            map.on('click', onMapClick);

            runMap();
        </script>

    </div>

</body>
</html>
