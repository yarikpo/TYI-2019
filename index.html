<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TYI-2019</title>
    <link rel="stylesheet" href="./css/style.css">


    <script>



        var isUpDown = 0;
        var isDot = true;
        var lineColor = 'red';

        function runMap(isCheck=-1) {
            // 50.255759, 35.158128
            // 49.392233, 36.236860
            // x1 y1 -> x2 y2
            // x3 y3 -> x4 y4
            if (isCheck != -1) {
                isUpDown = isCheck;
            }
            if (isCheck == 0) {
                isDot = true;
                lineColor = 'blue';
            }
            if (isCheck == 1) {
                isDot = true;
                lineColor = 'blue';
            }
            if (isCheck == 2) {
                lineColor = 'red';
                isDot = false;
            }


            var latlngs = null;
            function createRectangle(x1, y1, x4, y4) {
            	x2 = x4;
                y2 = y1;
                x3 = x1;
                y3 = y4;
                latlngs = [
                	[x1, y1],
                    [x2, y2],
                    [x4, y4],
                    [x3, y3],
                    [x1, y1],
                ];
            }

            function createDot(x, y) {
                latlngs = [
                    [x, y],
                    [x + 0.0001, y],
                    [x + 0.0001, y + 0.0001],
                    [x, y + 0.0001],
                    [x, y],
                ];
            }

            var xDron = document.getElementById("dronX").value;
            var yDron = document.getElementById("dronY").value;
            xDron = parseFloat(xDron);
            yDron = parseFloat(yDron);

            var x1 = document.getElementById("upLeftCornerX").value;
            var y1 = document.getElementById("upLeftCornerY").value;
            x1 = parseFloat(x1);
            y1 = parseFloat(y1);

            var x3 = document.getElementById("downRightCirnerX").value;
            var y3 = document.getElementById("downRightCirnerY").value;
            x3 = parseFloat(x3);
            y3 = parseFloat(y3);

            if (isDot == true)
                createDot(xDron, yDron);
            if (isDot == false)
                createRectangle(x1, y1, x3, y3);

            // var latlngs = [
            //      [49.621593, 36.401131],
            //      [37.77, -122.43],
            //      [34.04, -118.2]
            // ];


            function clearLine() {
                // It clears polylines
                for(i in map._layers) {
                	if(map._layers[i]._path != undefined) {
                    	try {
                        	map.removeLayer(map._layers[i]);
                        }
                        catch(e) {
                        	console.log("problem with " + e + map._layers[i]);
                        }
                    }
                }
            }

            if (isUpDown == 1) {
                clearLine();
            }

            if (latlngs != null) {
                var polyline = L.polyline(latlngs, {color: lineColor}).addTo(map);
                // zoom the map to the polyline
                if (isDot == false)
                    map.fitBounds(polyline.getBounds());
            }
        }


        function Reset() {
            isUpDown = 0;
            isDot = true;
            lineColor = 'red';

			// It clears polylines
	        for(i in map._layers) {
	            if(map._layers[i]._path != undefined) {
	                try {
	                    map.removeLayer(map._layers[i]);
	                }
	                catch(e) {
	                  	console.log("problem with " + e + map._layers[i]);
	                }
	            }
	        }

            document.getElementById("dronX").value = "";
            document.getElementById("dronY").value = "";

	        document.getElementById('upLeftCornerX').value = "";
    		document.getElementById('upLeftCornerY').value = "";

    		document.getElementById('downRightCirnerX').value = "";
    		document.getElementById('downRightCirnerY').value = "";
		}
    </script>


</head>
<body>
    <div id="ever">
        <script src="https://unpkg.com/leaflet@1.0.1/dist/leaflet.js"></script>
        <link href="https://unpkg.com/leaflet@1.0.1/dist/leaflet.css" rel="stylesheet"/>
        <div id="mapid"></div>

        <form action="main.py" method="get" id="send">
        	<div class="gradientRight">
        		<div class="block">
	        		<!-- <span>x up left: </span> -->
	        		<input placeholder="x up left" class="greyText text" id="upLeftCornerX" name="upLeftCornerX" type="number" step="0.0000001" class="inp">
	        	</div>
        	</div>
        	<div class="gradientLeft">
        		<div class="block">
	            	<!-- <span>y up left: </span> -->
	            	<input placeholder="y up left" class="greyText text" id="upLeftCornerY" name="upLeftCornerY" type="number" step="0.0000001" class="inp">
	            </div>
        	</div>

            <div class="gradientRight">
            	<div class="block">
					<!-- <span>x down right: </span> -->
					<input placeholder="x down right" class="greyText text" id="downRightCirnerX" name="downRightCirnerX" type="number" step="0.0000001" class="inp">
				</div>
            </div>
			<div class="gradientLeft">
				<div class="block">
	            	<!-- <span>y down right: </span> -->
	            	<input placeholder="y down right" class="greyText text" id="downRightCirnerY" name="downRightCirnerY" type="number" step="0.0000001" class="inp">
	            </div>
			</div>

            <div class="gradientRight">
            	<div class="block">
					<!-- <span>x dron: </span> -->
					<input placeholder="dron x" class="greyText text" id="dronX" name="dronX" type="number" step="0.0000001" class="inp">
				</div>
            </div>
			<div class="gradientLeft">
				<div class="block">
	            	<!-- <span>y dron: </span> -->
	            	<input placeholder="dron y" class="greyText text" id="dronY" name="dronY" type="number" step="0.0000001" class="inp">
	            </div>
			</div>



            <!-- <input type="text" class="inp">
            <input type="text" class="inp"> -->


			<div>
				<input class="blackText btn" id="submit" type="submit" value="submit">
			</div>
            <div>
            	<input class="blackText btn" id="check" type="button" name="check" value="Check" onclick="runMap(0); runMap(1); runMap(2); runMap(0);">
            </div>


			<div>
				<input class="blackText btn" id="reset" type="button" name="reset" value="reset" onclick="Reset();">
			</div>


        </form>

        <script>
            // Where you want to render the map.
            var element = document.getElementById('mapid');

            // Height has to be set. You can do this in CSS too.
            // element.style = 'height:100%;';

            // Create Leaflet map on map element.
            var map = L.map(element);

            // Add OSM tile leayer to the Leaflet map.
            L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
                attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
            }).addTo(map);

            // Target GPS coordinates.
            var target = L.latLng('49.621593', '36.401131');

            // ###################

            // var mycircle = OpenLayers.Geometry.Polygon.createRegularPolygon(
            //     target,
            //     50000,
            //     40,
            //     0
            // );

            // ###################



            // Set map center to target with zoom 14.
            map.setView(target, 8);





            isUpDown = 0; // false -> UpLeft;    true -> DownRight
            function onMapClick(e) {
            	var lat  = e.latlng.lat.toFixed(5);
    			var lon  = e.latlng.lng.toFixed(5);
    			console.log(lat);
    			console.log(lon);
    			console.log(isUpDown);
                if (isUpDown == 0) {
                    isDot = true;
                    lineColor = 'blue';
                    document.getElementById('dronX').value = lat;
                    document.getElementById('dronY').value = lon;
                } else if (isUpDown == 1) {
                    isDot = true;
                    lineColor = 'blue';
    				document.getElementById('upLeftCornerX').value = lat;
    				document.getElementById('upLeftCornerY').value = lon;
    			} else if (isUpDown == 2) {
                    lineColor = 'red';
                    isDot = false;
    				document.getElementById('downRightCirnerX').value = lat;
    				document.getElementById('downRightCirnerY').value = lon;
    			}
    			isUpDown = (isUpDown + 1) % 3;
    			runMap();
            }

            map.on('click', onMapClick);

            runMap();
        </script>

    </div>

</body>
</html>
